<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><p>Ice-node is the <strong>fastest</strong> framework for building node web applications, based on <a href="https://github.com/losfair/IceCore">Ice Core</a>.</p>
<p><a href="https://travis-ci.org/losfair/ice-node"><img src="https://travis-ci.org/losfair/ice-node.svg?branch=master" alt="Build Status"></a></p>
<p><a href="https://github.com/losfair/ice-node/blob/master/README-zh_CN.md">简体中文</a></p>
<h1>Why Ice-node ?</h1><h3>Fast</h3><p>Ice-node is based on Ice Core, which is written in Rust and C++ and provides high-performance abstractions for the Web.</p>
<p>When serving the &quot;Hello world!&quot; text, Ice-node is about 10% faster than the raw Node.js http implementation, 80% than Koa, and 100% than Express, while providing full routing support.</p>
<h5>Requests per second, higher is better</h5><p><img src="http://i.imgur.com/TkV8IxE.png" alt="Benchmark Result"></p>
<p><a href="https://gist.github.com/losfair/066b04978d6a5b27418d85a6305ecd5c">Raw Results</a></p>
<p>For practical applications that do database queries and some logic, Ice-node is also at least 30% faster than Express.</p>
<p>We wrote a <a href="https://github.com/losfair/ice-node-perf-tests">test application</a> that simulates some common API services like login and data fetching and do MongoDB queries when processing requests,
and fire up 500 concurrent clients, each doing 101 requests:</p>
<h5>Time for 500 * 101 requests, lower is better:</h5><p><img src="http://i.imgur.com/OIEUPOr.png" alt="Benchmark Result"></p>
<p><a href="https://gist.github.com/losfair/4d219e98b2e207ad4985b75304321292">Raw Results</a></p>
<h3>Easy to use</h3><p>Ice-node makes use of ES6 and later features like async functions to provide a better coding experience for developers.</p>
<p>A simple server using Ice-node looks like this:</p>
<pre class="prettyprint source"><code>const ice = require(&quot;ice-node&quot;);
const app = new ice.Ice();

app.get(&quot;/&quot;, req => &quot;Hello world!&quot;);

app.listen(&quot;127.0.0.1:3535&quot;);</code></pre><h1>Install</h1><p>Ice-node requires node v7.6.0 or higher for ES2015 and async function support, and, of course, Ice Core for everything.</p>
<p><strong>If you don't have Ice Core installed on your system yet, go to <a href="https://github.com/losfair/IceCore">Ice Core</a> for instructions.</strong></p>
<p>You can quickly install a supported version of node with your favorite version manager:</p>
<pre class="prettyprint source"><code>$ nvm install 7
$ npm install --save ice-node
$ node my-ice-node-app.js</code></pre><h1>Application</h1><p>With <code>const app = new ice.Ice()</code>, you creates an Ice-node <strong>Application</strong> - an object describing how requests will be handled and how your data will be presented to users,
containing arrays of <code>routes</code>, <code>middlewares</code>, key-value mappings of <code>templates</code>, and a <code>config</code> object.</p>
<p>Every middleware and routing endpoint will receive a <code>Request</code> object once reached, providing access to details of the request, including URL, params, headers, cookies, remote address, method and body.</p>
<p>A simple app that responds with the <code>text</code> param:</p>
<pre class="prettyprint source"><code>const ice = require(&quot;ice-node&quot;);
const app = new ice.Ice();

app.get(&quot;/:text&quot;, req => req.params.text);

app.listen(&quot;127.0.0.1:3536&quot;);</code></pre><h3>The Request object</h3><p>The Request object, which is passed to middlewares and endpoints, contains the following fields:</p>
<ul>
<li><code>headers</code> (object): Key-value mappings of request headers, with all keys in lower case.</li>
<li><code>uri</code> (string): The full URI of the request.</li>
<li><code>url</code> (string): Request URL.</li>
<li><code>remote_addr</code> (string): Remote address.</li>
<li><code>method</code> (string): Request method, in upper case (<code>GET</code>, <code>POST</code> etc.) .</li>
<li><code>host</code> (string): Alias for <code>headers.host</code>.</li>
<li><code>cookies</code> (proxied object): Key-value mappings of cookies in the <code>Cookie</code> header.</li>
<li><code>session</code> (proxied object): Key-value read and write access to the session of the request.</li>
<li><code>params</code> (proxied object): Key-value mappings of params in request URL.</li>
</ul>
<p>For example, the following code:</p>
<pre class="prettyprint source"><code>app.get(&quot;/ip&quot;, req => req.remote_addr.split(&quot;:&quot;)[0]);</code></pre><p>will return the visitor's IP address.</p>
<p>All of the proxied object do lazy load, bringing zero overhead if you don't use them.</p>
<h3>Middlewares and Endpoints</h3><p>Similar to Ice Core, Ice-node is targeted at <strong>endpoint</strong>s, the last handler requests may reach.</p>
<p>Compared to some other node web frameworks targeting middlewares, our design makes it easier to optimize the performance and simplify user logics.</p>
<p>Due to the way Ice-node handle endpoints and middlewares, only requests hitting an endpoint will be processed by middlewares. For example,</p>
<pre class="prettyprint source"><code>app.use(&quot;/&quot;, req => console.log(req.url));
app.get(&quot;/hello_world&quot;, req => &quot;Hello world!&quot;);</code></pre><p>will:</p>
<ol>
<li>GET <code>/hello_world</code> =&gt; Log the request URL and respond with &quot;<code>Hello world!</code>&quot;</li>
<li>POST <code>/hello_world</code> =&gt; Log the request URL and respond with 405 error</li>
<li>GET <code>/test</code> =&gt; No log, respond with 404 Not Found</li>
</ol>
<p>because the core router can find a path to the endpoint <code>/hello_world</code> but not to <code>/test</code>.</p>
<h3>Return values and exceptions</h3><p>All middlewares and endpoints may throw exceptions, terminating the current request.</p>
<p>For middlewares, a Response object as exception will be sent to the client, and all other exceptions lead to a 500 error.</p>
<p>For endpoints, any exceptions thrown lead to a 500 error.</p>
<p>Only endpoints' return values are processed. If it is a Response object, it will be sent to the client. Otherwise, Ice-node will try to construct a Response object from it.</p>
<h3>Async functions as endpoint handlers</h3><p>Async functions can be used as endpoint handlers. For example:</p>
<pre class="prettyprint source"><code>function sleep(ms) {
    return new Promise(cb => setTimeout(() => cb(), ms));
}

app.get(&quot;/sleep/:time&quot;, async req => {
    await sleep(parseInt(req.params.time));
    return &quot;OK&quot;;
});</code></pre><p>However, middlewares are not <code>await</code>ed and <strong>MUST NOT</strong> bring the Request object into the next tick - it leads to undefined behavior.
Consider to store your state in sessions, to be accessed fast and synchronously.</p>
<h3>Flags</h3><p>Flags, which are directly passed to the core, can be declared in the form of middlewares:</p>
<pre class="prettyprint source"><code>app.use(&quot;/user/&quot;, new ice.Flag(&quot;init_session&quot;));</code></pre><p>Flags are used to enable or disable core features like session management and request body reading.</p>
<h3>Sessions</h3><p>Ice Core provides built-in session support and is available from Ice-node.</p>
<p>Currently, sessions are stored in memory and are concurrently garbage-collected based on timeouts.</p>
<p>Sessions can be enabled by the flag <code>init_session</code>, and are automatically created, renewed and destroyed.</p>
<p>To set session timeout, pass <code>session_timeout_ms</code> parameter when creating the application:</p>
<pre class="prettyprint source"><code>const app = new ice.Ice({ session_timeout_ms: 1800000 });</code></pre><p>To access the session, use <code>req.session</code> object:</p>
<pre class="prettyprint source"><code>app.use(&quot;/user/&quot;, new ice.Flag(&quot;init_session&quot;));

app.get(&quot;/user/logout&quot;, req => {
    if(req.session.logged_in == &quot;true&quot;) {
        req.session.logged_in = &quot;false&quot;;
        return &quot;OK&quot;;
    } else {
        return &quot;Not logged in&quot;;
    }
});</code></pre><p>To remove a session item, set it to <code>null</code>.</p>
<p>Note that all session keys and values must be strings.</p>
<h1>Server</h1><p>By <code>app.listen(&quot;127.0.0.1:3535&quot;)</code>, Ice-node builds up handlers, initializes the server instance and fires it up.</p>
<h1>Bugs &amp; improvements</h1><p>Both Ice Core and Ice-node are still in early development, and contributions are welcome.</p>
<p>Use <a href="https://github.com/losfair/ice-node/issues">Issues</a> and pull requests to let us know your ideas!</p></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Flag.html">Flag</a></li><li><a href="Ice.html">Ice</a></li><li><a href="Response.html">Response</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> on Mon Jul 31 2017 17:42:12 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>